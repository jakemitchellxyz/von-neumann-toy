cmake_minimum_required(VERSION 3.16)
project(vnt LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Point CMake to vcpkg-installed Qt6 (static build)
list(APPEND CMAKE_PREFIX_PATH "${CMAKE_SOURCE_DIR}/../vcpkg_installed/x64-windows-static-md")

find_package(Qt6 REQUIRED COMPONENTS AppManMainPrivate)
find_package(Qt6 REQUIRED COMPONENTS Widgets)

if(QT_KNOWN_POLICY_QTP0001)
    qt_policy(SET QTP0001 NEW)
endif()
if(QT_KNOWN_POLICY_QTP0004)
    qt_policy(SET QTP0004 NEW)
endif()

## System-UI ##

qt_standard_project_setup()

qt_add_executable(vnt
    entrypoint.cpp
)

qt_add_qml_module(vnt
    URI Launcher
    QML_FILES
        windows/launcher.qml
    RESOURCES
        am-config.yaml
)

# This define flags us as an "appman" and allows us to link against the AppMan's private libraries
target_compile_definitions(vnt PRIVATE AM_COMPILING_APPMAN)
target_link_libraries(vnt PRIVATE Qt::AppManMainPrivate)
target_link_libraries(vnt PRIVATE Qt6::Widgets)

set_target_properties(vnt PROPERTIES
    WIN32_EXECUTABLE OFF
    MACOSX_BUNDLE ON
)

# Static linking: no DLL copying needed for Release builds
# Qt plugins are statically linked via qt_import_plugins()

## Apps ##

qt_am_create_builtin_package(von-neumann-toy
    OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
    FILES
        info.yaml
        windows/controls.qml
        windows/data.qml
)

install(TARGETS vnt)
